# 锁
### 悲观锁
先上锁，再处理数据，保证了并发的安全性，但是降低了效率
例如mysql的排它锁，select xxx for update强制锁住
mysql中行级锁基于索引的，如果sql没有走索引，那将用表级锁把整个表锁住
### 乐观锁
#### CAS
包含了三个操作数
1. 需要读写的内存位置V
2. 进行比较的预期值A
3. 拟写入的新值B
如果内存位置V的值等于预期的A值，则将该位置更新为新值B，否则不进行任何操作。许多CAS的操作是自旋的：如果操作不成功，会一直重试，直到操作成功为止。
	这里引出一个新的问题，既然CAS包含了Compare和Swap两个操作，它又如何保证原子性呢？
	答案是：CAS是由CPU支持的原子操作，其原子性是在硬件层面进行保证的。
#### 版本号
版本号机制的基本思路是在数据中增加一个字段version，表示该数据的版本号，每当数据被修改，版本号加1。
- 当某个线程查询数据时，将该数据的版本号一起查出来；
- 当该线程更新数据时，判断当前版本号与之前读取的版本号是否一致，如果一致才进行操作。
需要注意的是，这里使用了版本号作为判断数据变化的标记，实际上可以根据实际情况选用其他能够标记数据版本的字段，如时间戳等。
### redis锁

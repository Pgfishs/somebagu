# Redis
### 什么是redis
基于内存的数据库，对数据的读写都是在内存中完成的，读写速度非常快，用于缓存、消息队列、分布式锁登场景
redis提供了多种数据类型，String、Hash、List、Set、Zset、Bitmaps、HyperLogLog、GEO、Stream，对数据类型的操作都是原子性的，因为**执行命令由单线程负责**，不存在并发竞争的问题
redis还支持事务、持久化、lua脚本、多种集群方案、发布/订阅模式、内存淘汰机制、过期删除机制等
### 和memcached异同
1. 都是基于内存的数据库，当做缓存使用
2. 都有过期策略
3. 高性能
区别
- redis数据更丰富，memcached只支持k-v数据结构
- redis支持持久化，保存在磁盘中，memcached挂掉后数据就没了
- redis原生支持集群模式，memcached需要依赖客户端实现往集群中分片写入数据
- redis支持订阅发布模型、lua脚本、事务等功能
### 为什么用redis作为mysql缓存
1. redis具备高性能。将访问数据缓存在redis中，下次访问时直接从缓存中读取，mysql数据改变后同步改变redis中数据即可，会有双写一致性问题
2. redis具备高并发。redis的qps可以破10w，而mysql很难破1w
# Redis数据结构
- String：缓存对象、常规计数、分布式锁、共享session等
- List：消息队列（生产者需要自行实现全局唯一ID，不能以消费组形式消费数据）
- Hash：缓存对象、购物车等
- Set：聚合计算（并集、交集等），比如点赞、共同关注等
- Zset：排序场景，比如排行榜、电话和姓名排序
以上是五种常见数据类型
----------
- BitMap：二值状态统计，比如签到、判断登陆状态、签到用户数等
- HyperLogLog：海量数据基数统计场景，比如百万级网页UV计数
- GEO：储存地理位置信息，比如嘀嘀打车
- Stream：消息队列（实现List没有的两个特性）
### 五种常见数据类型的实现
#### String
基于SDS简单动态字符串
- SDS可以保存二进制数据。使用len而非空字符判断是否结束，SDS所有API会处理二进制方式处理SDS存放在buf数组的数据，所以SDS还可以保存图片、音频、视频这样二进制数据
- SDS获取字符串长度的时间复杂度是O(1)
- SDS API是安全的，拼接字符串不会导致缓冲区溢出
#### List
双向链表或压缩列表
- 列表元素小于512个且每个元素值小于64，使用压缩列表
- 不满足上面使用双向链表
在3.2版本后，只用quicklist实现，代替了双向链表和压缩列表
#### Hash
压缩列表或哈希表
- 列表元素小于512个且每个元素值小于64，使用压缩列表
- 不满足上面使用哈希表
在7.0中压缩列表被listpack实现
#### Set
哈希表或整数集合
- 元素都是整数且个数小于512，使用整数集合
- 否则使用哈希表
#### Zset
压缩列表或跳表
- 元素小于128个且值小于64字节，使用压缩列表
- 否则使用跳表
7.0中由listpack实现压缩列表
# Redis线程模型
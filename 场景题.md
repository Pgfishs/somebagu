# TOP K
### 10亿个数据中找出最大的10000个？——最小堆
最小堆法
	先拿10000个数建堆，然后逐个添加剩余元素；如果大于堆顶的数（10000中最小的），将这个数替换堆顶，并调整结构使之仍然是一个最小堆
	遍历完后，堆中的10000个数就是所需的最大的10000个
	复杂度分析：时间复杂度是O（mlogm），算法的时间复杂度为O（nmlogm）（n为10亿，m为10000）
优化方法
	如果内存受限：可以直接在内存总使用Hash方法将数据划分成npartition，每个partition交给一个线程处理，线程的处理逻辑可以采用最小堆，最后一个线程将结果归并
进一步优化：
	该方法存在一个瓶颈会明显影响效率，即数据倾斜。每个线程的处理速度可能不同，快的线程需要等待慢的线程，最终的处理速度取决于慢的线程。而针对此问题解决的方法是，将数据划分成c×n个partition（c>1），每个线程处理完当前partition后主动取下一个partition继续处理，直到所有数据处理完毕，最后由一个线程进行归并
如果含较多重复值：先用hash / 依图法去重，可大大节省运算量
### 有几台机器存储着几亿淘宝搜索日志，你只有一台 2g 的电脑，怎么选出搜索热度最高的十个？
针对top k类文本问题，通常比较好的方案是【分治+trie树/hash+小顶堆】，先将数据集按照hash方法分解成多个小数据集，然后使用trie树或者hash统计每个小数据集中的query词频，之后用小顶堆求出每个数据集中出频率最高的前K个数，最后在所有top K中求出最终的top K
- 拆分成n多个文件：以首字母区分，不同首字母放在不同文件，长度仍过长的继续按照次首字母进行拆分。这样一来，每个文件的每个数据长度相同且首字母尾字母也相同，就能保证数据被独立的分为了n个文件，且各个文件中不存在关键词的交集
- 分别词频统计：对于每个文件，使用hash或者Trie树进行进行词频统计
- 小顶堆排序：依次处理每个文件，并逐渐更新最大的十个词
### 提取某日访问次数最多的IP地址
将去进行 %1024 取模散列到1024个文件中（划分子文件方法之一）
采用hashmap对其进行次数统计 最后用排序算法进行排序
### 数据太多，内存不够，找到最热门的K个数据
首先对数据进行预处理，采用hash表统计次数 然后再排序
# 海量数据排序、压缩问题
### 重要方法——位图法 Bitmap
位图的基本概念：用一个位（bit）来标记某个数据的存放状态。例如，有{2, 4, 5, 6, 67, 5}这么几个整数，维护一个 00…0000（共67位）的0/1字符串，1表示该索引（=数据值）处存在数，0则表示不存在
应用：位图法可以用于海量数据排序，去重，压缩
优点：针对于稠密数据集可以很好体现出位图法的优势，内存消耗少，速度较快
缺点：不适用于稀疏数据集，比如我们有一个长度为10的序列，最大值为20亿，则构造位串的内存消耗将相当大250M，而实际却只需要40个字节，此外位图法还存在可读性差等缺点
### 非重复排序
假设有一个不重复的整型序列{n1， n2， ... ,nn}，假设最大值为nmax，则可以维护一个长度为nmax的位串。主要过程就是2步：
- 第一遍遍历整个序列，将出现的数字在位串（java中可以用数组实现）中对应的位置置为1；
- 第二遍遍历位图，依次输出值为1的位对应的数字，这些1所在的位串中的位置的索引代表序列数据，1出现的先后位置则代表序列的大小关系
### 数据压缩
**前提**：数据中存在大量的冗余值  
基本思路就是使用某个子串存储原数据中的海量值
### 如何用redis存储统计1亿用户一年的登陆情况，并快速检索任意时间窗口内的活跃用户数量
在redis 2.2.0版本之后，新增了一个位图数据。redis单独对bitmap提供了一套命令。可以对任意一位进行设置和读取。所以可以在位图中使用1表示活跃。
bitmap的核心命令：
- SETBIT：设置某位为1，语法：`SETBIT key offset value`
- GETBIT：获取某位的值  语法：`GETBIT key offset`
bitmap的其他命令还有bitcount，bitpos，bitop等命令。都是对位的操作。
- 获取某一天id为88000的用户是否活跃：getbit 2020-01-01 88000 [时间复杂度为O(1)]
- 统计某一天的所有的活跃用户数：bitcount 2019-01-01 [时间复杂度为O(N)]
- 统计某一段时间内的活跃用户数，需要用到bitop命令。这个命令提供四种位运算，AND(与)，(OR)或，XOR(亦或)，NOT(非)。我们可以对某一段时间内的所有key进行OR(或)操作，或操作出来的位图是0的就代表这段时间内一次都没有登陆的用户。那只要我们求出1的个数就可以了
### 海量文本去重——simhash法
[参考](https://cloud.tencent.com/developer/article/1379302?from=14588)
# 资源 vs 请求问题

# 怎么实现朋友圈的发和查看
微信朋友圈 一个用户好多好友
发朋友圈-自己能看到，朋友也能看到
用户量比较大，活跃用户比较多，用户好友数有限制，发朋友圈数量有限制
